# Mini-CRM API

–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è CRM-—Å–∏—Å—Ç–µ–º–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π, –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤, —Å–¥–µ–ª–æ–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## –ß—Ç–æ —ç—Ç–æ?

–≠—Ç–æ backend-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∂–∞–º–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏** ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–∞–Ω–∏–π –≤ –æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—è–º–∏** ‚Äî owner, admin, manager, member
- **–ö–æ–Ω—Ç–∞–∫—Ç—ã** ‚Äî –∫–ª–∏–µ–Ω—Ç—ã –∏ –ø–∞—Ä—Ç–Ω–µ—Ä—ã
- **–°–¥–µ–ª–∫–∏** ‚Äî —Å —Å—É–º–º–∞–º–∏, —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∏ —Å—Ç–∞–¥–∏—è–º–∏ –≤–æ—Ä–æ–Ω–∫–∏
- **–ó–∞–¥–∞—á–∏** ‚Äî –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ —Å–¥–µ–ª–∫–∞–º
- **–¢–∞–π–º–ª–∞–π–Ω** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî —Å–≤–æ–¥–∫–∏ –∏ –≤–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- –ò–ª–∏: Python 3.12+, PostgreSQL 15+

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
cd crm
docker compose up --build
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `http://localhost:8000/docs`

### –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
cd crm
pip install poetry
poetry install
```

2. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
DEBUG=True
POSTGRES_DB="crm"
POSTGRES_PASSWORD="crm"
POSTGRES_USER="crm"
POSTGRES_PORT=5432
POSTGRES_HOSTNAME=db
DATABASE_DIALECT="postgresql"
JWT_ALGORITHM="HS256"
SECRET_KEY="FEWIFEIBFIUEWBIFBEIBFEWU"
ACCESS_TOKEN_LIFETIME=3600
REFRESH_TOKEN_LIFETIME=43200

```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
poetry run alembic upgrade head
```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:

```bash
poetry run uvicorn main:app --reload
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ —Å–ª–æ–∏:

```
crm/
‚îú‚îÄ‚îÄ auth/           # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ users/          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îú‚îÄ‚îÄ organizations/  # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ contacts/       # –ö–æ–Ω—Ç–∞–∫—Ç—ã
‚îú‚îÄ‚îÄ deals/          # –°–¥–µ–ª–∫–∏
‚îú‚îÄ‚îÄ tasks/          # –ó–∞–¥–∞—á–∏
‚îú‚îÄ‚îÄ activities/     # –¢–∞–π–º–ª–∞–π–Ω –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ analytics/      # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îî‚îÄ‚îÄ core/           # –û–±—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
    ‚îú‚îÄ‚îÄ database/   # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, UnitOfWork
    ‚îî‚îÄ‚îÄ environment/ # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç:

- `models.py` ‚Äî SQLAlchemy –º–æ–¥–µ–ª–∏ (—Ç–∞–±–ª–∏—Ü—ã)
- `entities.py` ‚Äî Pydantic –º–æ–¥–µ–ª–∏ (–±–∏–∑–Ω–µ—Å-–æ–±—ä–µ–∫—Ç—ã)
- `schemas.py` ‚Äî —Å—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ API
- `repositories.py` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- `usecases.py` ‚Äî —Å—Ü–µ–Ω–∞—Ä–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤, –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –∏—Ö –≤ —Å–µ—Ä–≤–∏—Å—ã)
- `router.py` ‚Äî HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `providers.py` ‚Äî Dependency Injection

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç FastAPI
- **Unit of Work** ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ use case
- **Dependency Injection** ‚Äî —á–µ—Ä–µ–∑ Dishka
- **Type hints** ‚Äî –≤–µ–∑–¥–µ
- **Async/await** ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å API

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –ø–µ—Ä–≤—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é:

```bash
curl -X POST http://localhost:8000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "alice@example.com",
    "password": "SecurePass123",
    "name": "Alice",
    "organization_name": "Acme Inc"
  }'
```

–û—Ç–≤–µ—Ç:

```json
{
  "data": {
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    "access_expiration": 1732281600,
    "refresh_expiration": 1732886400,
    "organization_id": "550e8400-e29b-41d4-a716-446655440000"
  }
}
```

### 2. –í—Ö–æ–¥

–î–ª—è –≤—Ö–æ–¥–∞ –Ω—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Organization-Id`:

```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -H "X-Organization-Id: 550e8400-e29b-41d4-a716-446655440000" \
  -d '{
    "email": "alice@example.com",
    "password": "SecurePass123"
  }'
```

### 3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:**

```bash
curl -X GET http://localhost:8000/api/v1/users/me \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>"
```

–û—Ç–≤–µ—Ç:

```json
{
  "data": {
    "id": "ae72a2ef-caa7-4739-96bf-c20518b06235",
    "email": "alice@example.com",
    "name": "Alice",
    "created_at": "2025-11-22T11:29:15.098Z"
  }
}
```

### 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π

**–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π (—Å —Ä–æ–ª—è–º–∏):**

```bash
curl -X GET http://localhost:8000/api/v1/organizations/me \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <any_org_id>"
```

–û—Ç–≤–µ—Ç:

```json
{
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "Acme Inc",
      "created_at": "2025-11-22T10:00:00Z",
      "role": "owner"
    },
    {
      "id": "660e8400-e29b-41d4-a716-446655440001",
      "name": "Tech Corp",
      "created_at": "2025-11-22T11:00:00Z",
      "role": "member"
    }
  ]
}
```

üí° **–í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Å–µ** –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –µ–≥–æ —Ä–æ–ª—è–º–∏ –≤ –∫–∞–∂–¥–æ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ.

**–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:**

```bash
curl -X GET http://localhost:8000/api/v1/organizations/members \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>"
```

üí° **–í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —É–∫–∞–∑–∞–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Organization-Id`. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ–∏—Ç –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö, –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–π—Ç–µ `X-Organization-Id` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞–∑–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.

**–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ owner/admin):**

```bash
curl -X POST http://localhost:8000/api/v1/organizations/members \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "bob@example.com",
    "role": "member"
  }'
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–æ–ª–∏: `owner`, `admin`, `manager`, `member`

**–ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ (—Ç–æ–ª—å–∫–æ owner/admin):**

```bash
curl -X PATCH http://localhost:8000/api/v1/organizations/members/<user_id> \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>" \
  -H "Content-Type: application/json" \
  -d '{
    "role": "manager"
  }'
```

**–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ owner/admin):**

```bash
curl -X DELETE http://localhost:8000/api/v1/organizations/members/<user_id> \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>"
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ owner –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

### 5. –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –¥–≤–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞:

- `Authorization: Bearer <access_token>`
- `X-Organization-Id: <organization_id>`

**–°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç:**

```bash
curl -X POST http://localhost:8000/api/v1/contacts \
  -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc..." \
  -H "X-Organization-Id: 550e8400-e29b-41d4-a716-446655440000" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "John Doe",
    "email": "john@example.com",
    "phone": "+1234567890"
  }'
```

**–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫:**

```bash
curl -X GET "http://localhost:8000/api/v1/contacts?page=1&page_size=20&search=john" \
  -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc..." \
  -H "X-Organization-Id: 550e8400-e29b-41d4-a716-446655440000"
```

### 6. –†–∞–±–æ—Ç–∞ —Å–æ —Å–¥–µ–ª–∫–∞–º–∏

**–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É:**

```bash
curl -X POST http://localhost:8000/api/v1/deals \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>" \
  -H "Content-Type: application/json" \
  -d '{
    "contact_id": "contact-uuid-here",
    "title": "Website redesign",
    "amount": 10000.00,
    "currency": "USD"
  }'
```

**–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**

```bash
curl -X PATCH http://localhost:8000/api/v1/deals/<deal_id> \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "won"
  }'
```

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–π–º–ª–∞–π–Ω–µ.

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**

```bash
# –°–¥–µ–ª–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "new" –∏–ª–∏ "in_progress", —Å—É–º–º–∞ –æ—Ç 1000 –¥–æ 50000
curl -X GET "http://localhost:8000/api/v1/deals?status=new&status=in_progress&min_amount=1000&max_amount=50000&order_by=amount&order=desc" \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>"
```

### 7. –ó–∞–¥–∞—á–∏

**–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É:**

```bash
curl -X POST http://localhost:8000/api/v1/tasks \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>" \
  -H "Content-Type: application/json" \
  -d '{
    "deal_id": "deal-uuid-here",
    "title": "Call client",
    "description": "Discuss proposal",
    "due_date": "2025-12-31"
  }'
```

### 8. –¢–∞–π–º–ª–∞–π–Ω –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–¥–µ–ª–∫–∏:**

```bash
curl -X GET http://localhost:8000/api/v1/deals/<deal_id>/activities \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>"
```

**–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**

```bash
curl -X POST http://localhost:8000/api/v1/deals/<deal_id>/activities \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "comment",
    "payload": {
      "text": "Client requested discount"
    }
  }'
```

### 9. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

**–°–≤–æ–¥–∫–∞ –ø–æ —Å–¥–µ–ª–∫–∞–º:**

```bash
curl -X GET "http://localhost:8000/api/v1/analytics/deals/summary?days=30" \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>"
```

–û—Ç–≤–µ—Ç:

```json
{
  "total_deals": 150,
  "deals_by_status": {
    "new": 45,
    "in_progress": 60,
    "won": 30,
    "lost": 15
  },
  "amount_by_status": {
    "new": "125000.00",
    "in_progress": "450000.00",
    "won": "890000.00",
    "lost": "75000.00"
  },
  "average_won_amount": "29666.67",
  "new_deals_last_n_days": 12
}
```

**–í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂:**

```bash
curl -X GET http://localhost:8000/api/v1/analytics/deals/funnel \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: <org_id>"
```

## –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –†–æ–ª–∏

–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ä–æ–ª—å –≤ —Ä–∞–º–∫–∞—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:

- **OWNER** ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É
- **ADMIN** ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø, –∫—Ä–æ–º–µ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- **MANAGER** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ —Å–¥–µ–ª–∫–∞–º–∏, –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏, –∑–∞–¥–∞—á–∞–º–∏
- **MEMBER** ‚Äî **–≤–∏–¥–∏—Ç –≤—Å—ë**, –Ω–æ –∏–∑–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å—É—â–Ω–æ—Å—Ç–∏ (–∫–æ–Ω—Ç–∞–∫—Ç—ã, —Å–¥–µ–ª–∫–∏, –∑–∞–¥–∞—á–∏)

### –ß—Ç–æ –º–æ–∂–µ—Ç –∫–∞–∂–¥–∞—è —Ä–æ–ª—å

| –î–µ–π—Å—Ç–≤–∏–µ | OWNER | ADMIN | MANAGER | MEMBER |
|----------|-------|-------|---------|--------|
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–∂–∏—Ö —Å–¥–µ–ª–æ–∫ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| –û—Ç–∫–∞—Ç —Å—Ç–∞–¥–∏–∏ —Å–¥–µ–ª–∫–∏ –Ω–∞–∑–∞–¥ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–∂–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| –£–¥–∞–ª–µ–Ω–∏–µ —á—É–∂–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–¥–∞—á** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–∂–∏—Ö –∑–∞–¥–∞—á | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| –£–¥–∞–ª–µ–Ω–∏–µ —á—É–∂–∏—Ö –∑–∞–¥–∞—á | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |

### Multi-tenant

–û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏:

```
alice@example.com:
  - Acme Inc (OWNER)
  - Tech Corp (MEMBER)
  - StartupXYZ (ADMIN)
```

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏:

1. **–í–æ–π–¥–∏—Ç–µ –≤ –ª—é–±—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é:** –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ —É–∫–∞–∂–∏—Ç–µ –ª—é–±—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é, –≤ –∫–æ—Ç–æ—Ä–æ–π —Å–æ—Å—Ç–æ–∏—Ç–µ
2. **–ü–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π:** `GET /api/v1/organizations/me` –≤–µ—Ä–Ω–µ—Ç –≤—Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å —Ä–æ–ª—è–º–∏
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `X-Organization-Id`:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ ID –Ω—É–∂–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
4. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ:** –ü—Ä–æ—Å—Ç–æ –º–µ–Ω—è–π—Ç–µ `X-Organization-Id` ‚Äî **—Ç–æ–∫–µ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ—Ç –∂–µ!**

**–í–∞–∂–Ω–æ:** –¢–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, —Å –∫–æ—Ç–æ—Ä–æ–π –≤—ã –≤–æ—à–ª–∏, –Ω–æ —ç—Ç–æ **–Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç** –≤–∞—Å. –í—ã –º–æ–∂–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π, –≤ –∫–æ—Ç–æ—Ä–æ–π —Å–æ—Å—Ç–æ–∏—Ç–µ, –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞–≤ –µ—ë ID –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Organization-Id`.

**–ü—Ä–∏–º–µ—Ä:**

```bash
# –®–∞–≥ 1: –õ–æ–≥–∏–Ω (–º–æ–∂–Ω–æ –≤ –ª—é–±—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é)
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "X-Organization-Id: org-1" \
  -d '{"email": "alice@example.com", "password": "pass"}'

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω

# –®–∞–≥ 2: –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
curl -X GET http://localhost:8000/api/v1/organizations/me \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: org-1"

# –û—Ç–≤–µ—Ç: [{"id": "org-1", "name": "Acme", "role": "owner"}, {"id": "org-2", "name": "Tech", "role": "member"}]

# –®–∞–≥ 3: –†–∞–±–æ—Ç–∞–µ–º –≤ Acme Inc (org-1)
curl -X GET http://localhost:8000/api/v1/contacts \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: org-1"

# –®–∞–≥ 4: –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ Tech Corp (org-2) ‚Äî —Ç–æ–∫–µ–Ω —Ç–æ—Ç –∂–µ!
curl -X GET http://localhost:8000/api/v1/contacts \
  -H "Authorization: Bearer <token>" \
  -H "X-Organization-Id: org-2"
```

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å–∏—Å—Ç–µ–º–∞:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω (–≤–∞–ª–∏–¥–µ–Ω –ª–∏, –Ω–µ –∏—Å—Ç–µ–∫ –ª–∏)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `X-Organization-Id` (—Å–æ—Å—Ç–æ–∏—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —ç—Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)
3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **–¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**
4. –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —ç—Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

## –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

### –°–¥–µ–ª–∫–∏

1. **–ù–µ–ª—å–∑—è –∑–∞–∫—Ä—ã—Ç—å —Å–¥–µ–ª–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `won`, –µ—Å–ª–∏ —Å—É–º–º–∞ <= 0**
   
   ```json
   // –í–µ—Ä–Ω–µ—Ç 400 Bad Request
   PATCH /api/v1/deals/{id}
   {
     "status": "won",
     "amount": 0
   }
   ```

2. **–û—Ç–∫–∞—Ç —Å—Ç–∞–¥–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω –¥–ª—è manager –∏ member**
   
   –°—Ç–∞–¥–∏–∏ –∏–¥—É—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É: `qualification` ‚Üí `proposal` ‚Üí `negotiation` ‚Üí `closed`
   
   MEMBER –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å–¥–µ–ª–∫—É –∏–∑ `negotiation` –æ–±—Ä–∞—Ç–Ω–æ –≤ `proposal`.

3. **–ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞/—Å—Ç–∞–¥–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è Activity**
   
   –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏ ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –ø–∏—à–µ—Ç –≤ —Ç–∞–π–º–ª–∞–π–Ω.

### –ö–æ–Ω—Ç–∞–∫—Ç—ã

1. **–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç, –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å —Å–¥–µ–ª–∫–∏ –≤ –ª—é–±–æ–π —Å—Ç–∞–¥–∏–∏**
   
   –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á—å—Ç–µ –≤—Å–µ —Å–¥–µ–ª–∫–∏.
   
   –û—à–∏–±–∫–∞: `409 Conflict` —Å –∫–æ–¥–æ–º `error.contact.has_deals`

### –ó–∞–¥–∞—á–∏

1. **–ù–µ–ª—å–∑—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `due_date` –≤ –ø—Ä–æ—à–ª–æ–º**
   
   –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ ‚Äî —Å–µ–≥–æ–¥–Ω—è.

2. **MEMBER –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö —Å–¥–µ–ª–æ–∫**

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

–í—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º. –ù–µ–ª—å–∑—è:

- –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –∏–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ A –∫ —Å–¥–µ–ª–∫–µ –∏–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ B
- –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–≤–µ—Ä–Ω–µ—Ç—Å—è 403 –∏–ª–∏ 404)

## –¢–µ—Å—Ç—ã

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
cd crm
poetry run pytest
```

–ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º:

```bash
poetry run pytest --cov=. --cov-report=html
```

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –≤—Ö–æ–¥
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏–∏)
- –ü—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

## –õ–∏–Ω—Ç–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Ruff** ‚Äî –±—ã—Å—Ç—Ä—ã–π –ª–∏–Ω—Ç–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è Python.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:

```bash
cd crm
poetry run ruff check .
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
poetry run ruff check --fix .
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞:

```bash
poetry run ruff format .
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
poetry run ruff format --check .
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞:

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `pyproject.toml` –≤ —Å–µ–∫—Ü–∏–∏ `[tool.ruff]`:

- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏: 100 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞ (pycodestyle)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ (pyflakes)
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ (isort)
- ‚úÖ –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ (pep8-naming)
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Python (pyupgrade)
- ‚úÖ –ü–æ–∏—Å–∫ –±–∞–≥–æ–≤ (flake8-bugbear)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è comprehensions
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å datetime

–ú–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏.

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
poetry run alembic revision --autogenerate -m "description"
```

–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
poetry run alembic upgrade head
```

–û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é:

```bash
poetry run alembic downgrade -1
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

**organizations**
- id (UUID)
- name
- created_at

**users**
- id (UUID)
- email (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- hashed_password
- name
- created_at

**organization_members** (—Å–≤—è–∑—å many-to-many —Å —Ä–æ–ª—è–º–∏)
- id (UUID)
- organization_id ‚Üí organizations.id
- user_id ‚Üí users.id
- role (OWNER, ADMIN, MANAGER, MEMBER)
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: (organization_id, user_id)

**contacts**
- id (UUID)
- organization_id ‚Üí organizations.id
- owner_id ‚Üí users.id
- name
- email
- phone
- created_at

**deals**
- id (UUID)
- organization_id ‚Üí organizations.id
- contact_id ‚Üí contacts.id
- owner_id ‚Üí users.id
- title
- amount (decimal)
- currency
- status (NEW, IN_PROGRESS, WON, LOST)
- stage (QUALIFICATION, PROPOSAL, NEGOTIATION, CLOSED)
- created_at
- updated_at

**tasks**
- id (UUID)
- deal_id ‚Üí deals.id
- title
- description
- due_date
- is_done
- created_at

**activities** (—Ç–∞–π–º–ª–∞–π–Ω)
- id (UUID)
- deal_id ‚Üí deals.id
- author_id ‚Üí users.id (nullable –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π)
- type (COMMENT, STATUS_CHANGED, STAGE_CHANGED, TASK_CREATED, SYSTEM)
- payload (JSON —Å –¥–µ—Ç–∞–ª—è–º–∏)
- created_at

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** ‚Äî –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **SQLAlchemy 2.0** ‚Äî ORM
- **Alembic** ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏
- **PostgreSQL** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Pydantic** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Dishka** ‚Äî dependency injection
- **JWT** ‚Äî —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞
- **bcrypt** ‚Äî —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **pytest** ‚Äî —Ç–µ—Å—Ç—ã

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `DATABASE_URL` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL | `postgresql+asyncpg://user:pass@localhost/crm` |
| `SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT | `your-secret-key-min-32-chars` |
| `JWT_ALGORITHM` | –ê–ª–≥–æ—Ä–∏—Ç–º JWT | `HS256` |
| `ACCESS_TOKEN_LIFETIME` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ access —Ç–æ–∫–µ–Ω–∞ (–º–∏–Ω—É—Ç—ã) | `30` |
| `REFRESH_TOKEN_LIFETIME` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ refresh —Ç–æ–∫–µ–Ω–∞ (–º–∏–Ω—É—Ç—ã) | `10080` (–Ω–µ–¥–µ–ª—è) |

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 401 Unauthorized

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ü–µ—Ä–µ–¥–∞–Ω –ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`
- –ù–µ –∏—Å—Ç–µ–∫ –ª–∏ —Ç–æ–∫–µ–Ω (access –∂–∏–≤–µ—Ç 30 –º–∏–Ω—É—Ç)

### 403 Forbidden

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ `X-Organization-Id` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
- –ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –ø—Ä–∞–≤–∞ –Ω–∞ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ (—Ä–æ–ª—å)

### 404 Not Found

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å—É—â–Ω–æ—Å—Ç—å —Å —Ç–∞–∫–∏–º ID
- –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ –æ–Ω–∞ –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

### 409 Conflict

–û–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª:
- –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å —Å–¥–µ–ª–∫–∏ (`error.contact.has_deals`)
- –î—É–±–ª–∏–∫–∞—Ç email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`error.user.already_exists`)
- –ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (`error.organization.member_already_exists`)

## Swagger UI

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:8000/docs
```

–¢–∞–º –º–æ–∂–Ω–æ:
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
- –£–≤–∏–¥–µ—Ç—å —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ `/api/v1/auth/register`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `access_token` –∏–∑ –æ—Ç–≤–µ—Ç–∞
3. –ù–∞–∂–º–∏—Ç–µ "Authorize" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
4. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω (–±–µ–∑ —Å–ª–æ–≤–∞ "Bearer")
5. –î–æ–±–∞–≤—å—Ç–µ `X-Organization-Id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è

1. –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `crm/new_module/`
2. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª—ã:
   - `models.py` ‚Äî SQLAlchemy –º–æ–¥–µ–ª–∏
   - `entities.py` ‚Äî Pydantic —Å—É—â–Ω–æ—Å—Ç–∏
   - `schemas.py` ‚Äî API —Å—Ö–µ–º—ã
   - `repositories.py` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ë–î
   - `usecases.py` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
   - `router.py` ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
   - `providers.py` ‚Äî DI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
   - `exceptions.py` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –≤ `main.py`
4. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤ `core/container.py`

### Code style

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- **Type hints** –≤–µ–∑–¥–µ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è mypy)
- **Async/await** –¥–ª—è –≤—Å–µ—Ö IO –æ–ø–µ—Ä–∞—Ü–∏–π
- **Pydantic** –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **–Ø–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- **Ruff** –¥–ª—è –ª–∏–Ω—Ç–∏–Ω–≥–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤** (isort —á–µ—Ä–µ–∑ ruff)

–ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –∑–∞–ø—É—Å–∫–∞–π—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
poetry run ruff check --fix .
poetry run ruff format .

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
poetry run mypy .

# –¢–µ—Å—Ç—ã
poetry run pytest
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è "–õ—é–±–∏–º–∞—è –∫—É—Ö–Ω—è"

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: shogo.ryaskov@gmail.com

